## 机智云

`机智云`是一个物联网/智能硬件云服务平台，提供了一系列物联网硬件开发工具以及服务，包括：硬件接入服务、开放平台服务以及统计分析服务。其中统计分析未见具体实现或设计，这部分的设计也许要等到平台相当成熟后才会启动吧。

从功能角度来看，机智云主要提供：平台服务、APP SDK和硬件接入。

### 平台服务

所有接入机智云的物联网硬件，设备能力以云端接口的方式通过授权进行调用，开发人员可通过调用接口实现设备内部业务逻辑的实现以及不同设备间的联动。

从目前接口公布的文档来看，平台主要提供如下服务功能：

- 用户注册/登录/个人信息修改
- 访问授权凭证管理
- 设备信息获取、绑定/解绑定、最近数据获取
- 基于厂家自定义的”数据点”和"原始控制指令”的远程设备控制
- 可设定设备状态的定时任务管理

核心概念以设备为中心，通过厂家自定义数据点或者原始指令来与设备交互；另在基本控制功能上，从核心服务上，增加了定时任务功能，提供定时自动控制功能。



### APP SDK

平台服务是通过 `iOS SDK/Android SDK`、`WebSocket API` 、`蓝牙接入 iOS SDK/Android SDK`的形式提供开发支持。

`iOS SDK/Android SDK` 和 `WebSocket API` 分别提供了 `iOS`、`Android` 和 `Web`访问 OpenAPI 的 SDK，以及这些终端获取实时数据的能力。

机智云的用户端获取实时数据的方式是让 iOS/Android/Web 客户端与云服务直接保持长连接，并定时 Pull 来拉取设备上下线状态和实时数据的。

蓝牙接入 iOS SDK/Android SDK 为 `iOS` 和 `Android` 设备提供了蓝牙设备接入并经由手机上传实时数据的开发支持。

### 硬件接入

推出了 GoKit 开发板，为硬件开发提供 WiFi 通讯原型环境，支持微信 AirKiss WiFi 配置协议，支持 OTA (远程固件更新)，数据连接采用 MQTT 协议。

在开发者支持上，提供"原始控制指令”和”数据点”两种数据格式。

`数据点`格式是官方主推格式。定义时通过 Web 界面辅助设定。当开发者要开发一款联网设备，在开发者账号中新增一款”产品"，设定产品名称、通讯方式（WiFi、BLE 或者 BT）、设备类型、板卡和通信模块；然后就可以为这款设备新增`数据点`，设定其类型、范围等等；接下来就可以按照定义的设备和数据点，用官方的 SDK 来开发设备的通讯模块了。

关于`数据点`，官方给出了基于类型描述的格式协议，未对数据点做任何业务上的规范性定义。

### 主要特点

- 云端基于 MQTT 的设备接入
- 云端基于设备的 Open API


- WiFi 硬件开发版及样例固件


- OTA 服务


- AirKiss 支持


- 移动开发 SDK



## AbleCloud

`AbleCloud` 号称`首家智能硬件Paas云平台`，具有一定的 `PaaS` 属性，提供基于`Java` 的云端应用执行环境、APP SDK、固件和 Demo 三大主要功能。

`AbleCloud` 面向厂家的特性，构建了自有的核心概念，主要包括产品、账号和设备相关的定义。

- 为厂家产品定义出主域、子域、产品、服务及版本；


- 账号分为普通用户账号和开发者账号；


- 设备分为设备、网关和子设备（通过网关转发数据的非 WiFi 设备）；

### 基于`Java` 的云端应用执行环境

首先， `AbleCloud` 只支持 `Java`，据说稍后会支持 `PHP` ，到目前为止尚未看到相关`PHP`支持的文档和信息。

`AbleCloud` 提供了一个抽象基类给开发者实现，作为 PaaS 的入口类，同时用一些标准的数据对象和 Java 服务对象，来提供设备访问的云服务。另外，`AbleCloud` 还定义了一个定时任务接口来提供定时任务服务。

### APP SDK

`AbleCloud` 提供了 iOS、Android 和 JavaScript 的 SDK，以简化各平台对服务接口的调用。

其中 iOS 和 Android 开发包均提供了基于回调的设备实时消息获取接口，尚不清楚采用的是 Pull 还是 Push 方式。Javascript 开发包未提供相关接口的说明文档。

### 固件和 Demo

`AbleCloud` 尚未提供硬件开发版，目前只提供了硬件开发的标准固件和开发文档，以及一个 WiFi 灯控  Demo。

其硬件方案是采用一个内含 AbleCloud 固件的 WiFi 模块来提供联网功能，这个 WiFi 模块和设备之间通过 AbleCloud 自定义的串口协议通讯，以实现远程控制和数据上传。

### 特点

- 面向设备连接的 Java PaaS 平台
- 面向厂商的产品定义
- 云端设备接入
- 通用 Key-Value 存储


- WiFi 固件


- OTA 服务


- 移动应用和 Javascript 开发 SDK



### Dolink Platform

Dolink Platform 的目的就是以标准的方式接入尽可能多的设备，并以此为用户提供`真正`意义上的 `智能化` 服务。了解一下 Dolink Plaform 的历史能够更好的帮助理解当下的 Dolink Platform。

Dolink Platform 到目前为止，已经经历过两个版本的开发。第一个 `V0` 版本以智能家居为目标领域，设计和开发历时两年，截至 2014 年底，完整的设计并实现了 Dolink Cloud，Hub 的软硬件开发，包括蓝牙 Tag、复合感应器、ZigBee 插座和智能灯带的软硬件和产品结构设计。

### Dolink Platform V0

#### 基本概念

`V0` 版本的整体设计完全围绕 `设备` 进行，`设备` 是整个系统中的一等公民。设备有若干属性，但下面几个标准属性唯一的标识了一个设备及其数据：

__GUID__：设备唯一标示号；

__DA__：设备上报的数据；

__D__：制造商设备型号 ID；

__V__：制造商 ID；

__G__：设备出现在系统中的序号；

#### Dolink Cloud

Dolink Cloud 完全使用 Node.js 开发，PM2 做进程管理，Redis 用来提供数据缓存和转发服务，并承担内部消息总线的职能，MySQL 用于存储用户和设备相关数据，内部消息总线和设备数据均采用 MQTT 协议。

`Node.js` 的异步处理模式非常适合小数据量高并发的物联网应用场合。

Dolink Cloud 共有两个核心服务组成，一个是面向应用接口的 API 服务，一个是面向设备的 MQTT 服务。服务使用 Redis 作为缓存服务器，均为无状态设计，用户与设备间的连接识别和数据通讯采用内部消息服务总线实现，这样的架构设计易于计算能力的扩展。

Dolink Cloud REST API提供了`基于 OAuth2 的授权`、`用户`、`Hubs`、`设备`和`规则`管理接口。

Dolink Cloud 是以开放 REST API 的方式提供服务的，其中 OAuth2 的授权就是用于授权第三方应用的。用户服务提供授权的用户信息修改功能。Hubs和设备，提供Hub和设备的管理功能。

Dolink Cloud 内置了一个通用的`规则引擎`，并提供了一个规则配置界面，用于实现设备互动场景。规则管理接口 API 可供第三方调用。

不同于其他物联网云平台，设备在 Dolink Cloud 上是不需要预先设定类型的，我们预定义了数百种设备的类型 ID，设备要做的就是选择一个或者从自定义区自定义一个序号，作为厂家设备型号 ID。

云端还引入了 `虚拟设备`，可把外部公共服务虚拟成设备，比如把 `天气` 作为一个虚拟设备，添加到当前帐户，简单设定后，便可以和其他物理设备通过规则引擎联动。

### Hub 

对于一些非 WiFi 协议的设备来说，要接入云端是非常困难的，这里 Hub 就起到了一个网关的作用。通过 Hub 可以把一些基于蓝牙、RF 433MHz、ZigBee的设备接入进来。比如：蓝牙 Tag，超便宜的 RF 433 遥控插座，以及受供电限制的其他无线设备。而本身不存在供电问题的传统夹家电例如：电扇、水壶、暖气、空调等则可用 WiFi 模块接入网络。

Dolink Hub 构建了一套驱动适配架构，用户可通过手机或者网页登陆后安装第三方驱动应用，以扩展 Hub 对其他设备的支持，比如：中国的 Hue - `YeeLight`。

### 设备和硬件接入

只有云端和 Hub 的开发是不足以深入参与到物联网甚至只是智能家居领域的，所以我们设计并开发了包括蓝牙 Tag、复合感应器、ZigBee 插座、智能灯带、智能电水壶、网络计数器等多款硬件原型，来验证 Dolink Platform 服务架构。

蓝牙 Tag、复合感应器、ZigBee 插座、智能灯带、网络计数器在 Dolink Hub + Dolink Cloud 下能够很好的工作，除了 复合感应器在 `设备控制 UI 设计` 和 `规则引擎设置` 下遇到了点问题。

由于智能电水壶是带电工作的，所以我们用 ESP8266 做为 WiFi 模块设计了一款 `Arduino 开发版`，并开发了一款通用的`固件 SDK`，并基于这款开发版改造了一款普通电水壶，实现了远程控制和状态跟踪功能。



## 问题

当我们在 `智能化` 这个智能化领域持续深耕细作的时候，发现设备联网后的若干问题。

- 人机交互问题：设备的控制不管是用 APP 还是用微信，都得首先打开 APP，查找设备，选择设备，点击操作。使用上来说要比遥控器麻烦。
- 连接和安全问题：尽管各家平台的看家本领都是让设备联网受控，但谁也没有办法应对用户网络故障甚至是恶意断网的情况，遇到这种情况，轻则设备无法控制、规则无法触发，重则本地安全受到威胁。
- 设备信息表达问题：对于大部分物联网应用，都有位置和事物概念的潜在需求，比如：家里主卧的电暖器，客厅的空调，公司的台灯等。假设这样一个场景：我在家里的每个房间和公司的工位上都放置了一款智能插座，我要区别他们的唯一办法就是为每个插座命个名，名字是插座本身呢，还是插在插座上的电器呢？如果插座上的电器换了呢？如果这个插座还关联了规则或者智能应用呢？随着场景的不断变化，用户将无所适从。
- 以规则为例的增值应用设备选择问题：严格意义上来说，规则引擎算是一个平台上的增值应用，在 SmartThings 里面叫 SmartApp，最终都是要实现 `如果` - `那么` 的条件触发功能。前面提到 `复合传感器` 在 `设备控制 UI 设计` 和 `规则引擎设置` 下遇到了点问题，这就是说，如果把复合传感器当作一个设备，那里面的温度、适度、位置、姿态、声感、光感、移动感应灯数据将会是一个复合数据，在规则设定的时候就无法筛选出 `条件` 项。`机智云` 和 `AbleCloud`  的数据项定义似乎可以解决这个问题，但是当这个设备是个控制设备时，同样无法筛选 `那么` 的动作选项。

面对这些问题，我们设计了 `Dolink Cloud V1`，并在持续开发中。

## Dolink Platform V1

为了解决 V0 版本遗留的问题，或者说是提升平台的智能化水平，我们重新设计并架构了 `Dolink Platform`。

- 人机交互问题：上面提到的人机交互问题，本质上是说平台需要从技术层面上提供更加智能的计策机制，更加便捷的设备操作手段。`V1` 分别在云端 和 Hub 端设计了 SmartApp 运行环境，让规则引擎更加傻瓜化。为云端和 Hub 端自动构建虚拟消息通知通道，以便 SmartApp  触发后发出询问通知。比如：手机提示"家中没人了，灯还开着，要关掉吗？”，同时提供两个选项：关闭和取消。另外，引入地点和组的概念后的，设备的选择可以按地点和组逐层进行。
- 连接和安全问题：`V1` 计划在 Hub 上构建一套能够本地运行的 Local  Cloud，通过同步手段与云端保持数据一致性，联网时，共享云端位置、虚拟设备等服务，可以通过用户终端设备遥控和监控；断网时能够独立运行，只是缺失了云端协调功能，不影响本地规则执行。
- 设备信息表达问题：在设备概念之外，加入 `地点`、`组` 和 `事物`  概念，事物是概念上的操作对象，SmartApp 关联 `事物` 而不是 `设备`，设备的更换不会有副作用。地点和组能够很好的标识设备的位置信息。
- 以规则为例的增值应用设备选择问题：这是由于平台缺乏更细致的标准导致的，由于没有定义设备应有的属性和操作，造成使用设备的应用方无法有效识别设备数据。这里，我们为设备增加了`Device Channel` 属性，类似 SmartThings 里的 Capability 概念，并为 `Device Channel` 属性定义标准操作，为 `Channel State` 定义数据项。非标准数据可自定义 Channel，只是可能不被大部分 SmartApp 识别。

关于 `Dolink Platform V1` 的详细文档，请参考`Dolink Platform 参考手册`。



## 对比分析











